# ğŸ† Wesnoth Tournament Manager - Contexto Permanente

## DescripciÃ³n General
Gestor web avanzado para torneos competitivos de Wesnoth. Permite:
- Registro y autenticaciÃ³n de jugadores
- CreaciÃ³n y gestiÃ³n de torneos (EliminaciÃ³n, Liga, Suizo, Mixto)
- Reporte, confirmaciÃ³n y disputa de partidas con ELO dinÃ¡mico
- Panel de administraciÃ³n multiidioma (EN, ES, DE, ZH)
- IntegraciÃ³n con Discord para notificaciones
- Almacenamiento y descarga de replays en Supabase Storage

## Stack TÃ©cnico
- **Frontend**: React 18+ (TypeScript), Vite, Zustand, i18n, Cloudflare Pages
- **Backend**: Node.js + Express (TypeScript)
- **Base de datos**: PostgreSQL (Supabase)
- **Storage**: Supabase Storage (replays)
- **Despliegue**: Railway (backend), Cloudflare Pages (frontend)

## Estructura Principal
```
â”œâ”€â”€ backend/          # API REST (TypeScript)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ routes/   # Endpoints de API
â”‚   â”‚   â”œâ”€â”€ services/ # LÃ³gica de negocio
â”‚   â”‚   â”œâ”€â”€ types/    # TypeScript interfaces
â”‚   â”‚   â””â”€â”€ config/   # BD, auth, etc
â”‚   â””â”€â”€ migrations/   # Scripts SQL
â”œâ”€â”€ frontend/         # React SPA
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ pages/    # Vistas principales
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ services/ # API calls
â”‚   â”‚   â”œâ”€â”€ store/    # State management (Zustand)
â”‚   â”‚   â””â”€â”€ i18n/     # Traducciones
â”œâ”€â”€ testing/          # Scripts de prueba
â””â”€â”€ docker-compose.yml
```

## Flujos de Usuario Clave
- **Jugador**: Registro â†’ Login â†’ Reportar partida â†’ Confirmar/disputar â†’ Ver ranking
- **Jugador**: Registro â†’ Login â†’ Unirse a torneo â†’ Reportar partida â†’ Confirmar/disputar â†’ Ver ranking
- **Jugador**: Crear torneo â†’ Configurar rondas â†’ Gestionar participantes â†’ Avanzar Rondas â†’ Cerrar torneo
- **Admin**: Moderar disputas

## Roles y Permisos
- **Organizador del torneo**: Puede definir las reglas del torneo, avanzar rondas, forzar resultados ante el abandono de un jugador o en base a una disputa resuelta.
- **Jugador**: Puede unirse, reportar, confirmar/disputar partidas, ver estadÃ­sticas
- **Admin**: Todo lo anterior + crear/editar/eliminar torneos, gestionar usuarios.

## Estados Principales
- **Torneos**: registration_open â†’ in_progress â†’ completed
- **Participantes**: pending â†’ approved â†’ active â†’ eliminated
- **Partidas**: pending_confirmation â†’ confirmed/disputed â†’ completed

## Entidades y Relaciones
- **Torneo** 1---N **Ronda** 1---N **Partida**
- **Jugador** N---N **Torneo** (participantes)
- **Partida**: winner, loser, mapa, facciones, replay, status

## Endpoints API Principales
- `POST /auth/register` - Registro
- `POST /auth/login` - Login
- `GET /tournaments` - Listar torneos
- `POST /tournaments` - Crear torneo (admin)
- `POST /matches/:id/report` - Reportar partida
- `POST /matches/:id/confirm` - Confirmar/disputar
- `GET /players/:id` - Perfil pÃºblico
- `GET /stats/elo` - Ranking global

## InternacionalizaciÃ³n (i18n)
- Traducciones en `/frontend/src/i18n/`
- Agregar idioma: crear archivo JSON y registrar en i18n.ts
- Soporte para fallback y ediciÃ³n en panel admin

## AutenticaciÃ³n y Estado
- JWT almacenado en localStorage
- Zustand para estado global (usuario, admin, idioma, etc.)
- Middleware de autenticaciÃ³n en backend

## Despliegue y CI/CD
- **Backend**: Railway (deploy automÃ¡tico desde main)
- **Frontend**: Cloudflare Pages (deploy desde main)
- **Scripts**: `production_deploy.ps1` para merge mainâ†’production
- **Variables de entorno**: `.env` (no versionar)

## Comandos Ãštiles
```bash
# Backend
cd backend && npm install && npm run dev
# Frontend
cd frontend && npm install && npm run dev
# Docker
docker-compose up
# Tests
npm test
```

## Archivos Clave
- `START_HERE.md` - GuÃ­a de inicio rÃ¡pido
- `TOURNAMENT_DOCUMENTATION_INDEX.md` - Ãndice de documentaciÃ³n
- `DEPLOYMENT_GUIDE.md` - GuÃ­a de despliegue
- `SECURITY_AUDIT_REPORT.md` - AuditorÃ­a de seguridad
- `vite.config.ts` - ConfiguraciÃ³n Vite/Cloudflare

## Prioridades y Roadmap
- [ ] Algoritmo suizo y standings automÃ¡ticos
- [ ] Mejoras UI admin y mobile
- [ ] 2FA y verificaciÃ³n email
- [ ] Tests E2E y cobertura

## Notas de ContribuciÃ³n
- TypeScript estricto
- Commits claros y descriptivos
- Revisar PRs antes de merge
- Mantener documentaciÃ³n actualizada

## Estado Actual (2025-12-23)
âœ… Funcionalidad core completa
âœ… Multiidioma y panel admin
âœ… Despliegue Cloudflare y Railway
â³ Mejoras UI y automatizaciÃ³n en curso

## Vertientes de la AplicaciÃ³n

La aplicaciÃ³n gestiona dos tipos de partidas:

- **Matches directos**: Partidas amistosas o competitivas que se juegan fuera de torneos. Los jugadores pueden reportar, confirmar o disputar estos matches de forma bilateral. El flujo es mÃ¡s simple y rÃ¡pido.

- **Matches de torneo**: Partidas asociadas a un torneo activo, el flujo estÃ¡ ligado a las rondas y reglas del torneo. Los jugadores pueden reportar, confirmar o disputar estos matches.

- **GestiÃ³n de disputas**: Solo el admin puede resolver disputas de partidas tanto directas como de torneo. Los jugadores pueden reportar y disputar, pero el administrador debe confirmar las disputas.

## Permisos sobre Torneos
- **CreaciÃ³n de torneos**: Cualquier usuario registrado (incluido el admin) puede crear un torneo y configurarlo.

- **InscripciÃ³n en torneos**: Los usuarios pueden solicitar unirse a un torneo, el organizador puede adminitr o rechazar

- **Abandono de Jugadores eliminaciÃ³n**: Solo el admin puede resolver disputas de partidas de torneo y eliminar torneos existentes. Los jugadores pueden reportar y disputar, pero no tomar decisiones finales sobre el resultado ni eliminar torneos.

## Datos requeridos para el reporte de partidas

Tanto en matches directos como en matches de torneo, el formulario de reporte solicita:
- **Mapa**
- **FacciÃ³n de cada jugador**
- **Jugadores participantes**
- **Archivo de replay** (opcional, pero recomendado)

Si se sube el replay, el sistema intenta autocompletar mapa, facciones y jugadores. Si no, estos datos pueden ser ingresados manualmente por el usuario.

## Instrucciones especÃ­ficas para Copilot

- **No ejecutar comandos git (commit, merge, push, etc.) automÃ¡ticamente.**
  - Si se requiere un comando git, solo indÃ­calo y explica el propÃ³sito, pero no lo ejecutes a menos que el usuario lo solicite explÃ­citamente.
- **No modificar archivos de configuraciÃ³n crÃ­ticos (.env, .gitignore, etc.) sin confirmaciÃ³n previa.**
- **No eliminar archivos ni carpetas sin autorizaciÃ³n expresa.**
- **Siempre pregunta antes de realizar acciones destructivas o irreversibles.**
- **Prioriza sugerencias y explicaciones antes que acciones automÃ¡ticas.**
- **No repetir cÃ³digo.**
  - Prioriza la refactorizaciÃ³n y la creaciÃ³n de componentes reutilizables siempre que tenga sentido, en vez de duplicar lÃ³gica o estructuras.
- **Mantener una referencia de API actualizada.**
  - Cada vez que se aÃ±ada, modifique o elimine un endpoint, actualiza la secciÃ³n o archivo de referencia de API (`API_ENDPOINTS.md`).
- **Mantener el esquema de base de datos actualizado.**
  - Cada vez que se realicen cambios en la estructura de la base de datos, actualiza el archivo de esquema (`DB_SCHEMA.md`).
- **Usar como referencia de navegacion.**
- Usar como referencia de navegacion y cada vez que se altere la estrucutra de navegacion o se aÃ±adan opciones actualiza el archivo (`NAV_INDEX.md`)

  - **GestiÃ³n de logs de debug**
  - cada vez que implementes un log de debug en funciÃ³n de si es backend o frontend condicionalo con las variables de entorno VITE_DEBUG_LOGS o BACKEND_DEBUG_LOGS co valores true se imprime el debug, false, no se imprime.




