
           POSTGRESQL → MARIADB MIGRATION - QUICK GUIDE                    ║



1. migration_complete.sh
   └─ Main script that automates the entire migration
   └─ Includes: export, conversion, import, reports
   └─ Execution: ./migration_complete.sh

2. convert_pg_copy_to_mariadb.py
   └─ Python script for data conversion
   └─ Transforms COPY format (PostgreSQL) to INSERT (MariaDB)
   └─ Groups rows per table for efficiency
   └─ Escapes reserved words (e.g.: `order`)

3. mariadb_database_migration_structure.sql
   └─ Defines structure of 28 tables with DROP and CREATE
   └─ Automatically executed by migration_complete.sh
   └─ Includes all columns and correct data types

4. MIGRATION_README_EN.md
   └─ Detailed documentation of the process
   └─ Requirements, installation, troubleshooting





OPTION 1 - Interactive Execution (RECOMMENDED):


   cd backend/migrations/
   ./migration_complete.sh

   The script will prompt for:
   • PostgreSQL: host, port, database, user, password
   • MariaDB:    host, port, database, user, password

   ⏱️  Estimated time: 2-5 minutes


OPTION 2 - Using Environment Variables:


   export PG_HOST="localhost"
   export PG_PORT="5432"
   export PG_DB="database"
   export PG_USER="postgres"
   export PG_PASS="your_pass"
   
   export MB_HOST="host"
   export MB_PORT="3306"
   export MB_DB="database"
   export MB_USER="user"
   export MB_PASS="your_pass"
   
   ./migration_complete.sh





STEP 1: Export data from PostgreSQL
   └─ File: pg_data_export_[TIMESTAMP].sql
   └─ Format: COPY (tab-separated values)

STEP 2: Get row counts BEFORE
   └─ File: before.txt
   └─ Contains: All tables and row counts from PostgreSQL

STEP 3: Convert data format
   └─ File: mariadb_converted_[TIMESTAMP].sql
   └─ Converts COPY → grouped INSERTs
   └─ Escapes reserved words
   └─ Cleans timestamps (remove +00 timezone)

STEP 4: Connect to MariaDB
   └─ Executes: mariadb_database_migration_structure.sql
   └─ Result: DROP + CREATE of 28 tables

STEP 5: Import data to MariaDB
   └─ Executes the converted SQL file
   └─ Total: 1,739 rows in 27 tables

STEP 6: Get row counts AFTER
   └─ File: after.txt
   └─ Contains: All tables and row counts from MariaDB

STEP 7: Generate comparison report
   └─ File: results.txt
   └─ Compares PostgreSQL vs MariaDB
   └─ Shows: ✓ SUCCESS or ✗ MISMATCH





In migrations directory:
   • before.txt       - Row counts from PostgreSQL
   • after.txt        - Row counts from MariaDB
   • results.txt      - Comparison report

In migration_tmp directory:
   • pg_data_export_[timestamp].sql     - Raw PostgreSQL data
   • mariadb_converted_[timestamp].sql  - Converted data



 SUCCESS VERIFICATION:


Migration was successful if:

   ✓ Script completes WITHOUT ERRORS
   ✓ results.txt shows: Status: ✓ SUCCESS
   ✓ Difference = 0 in summary
   ✓ All tables have ✓ in detailed comparison
   ✓ Total: PostgreSQL = MariaDB

Example of correct results.txt:

PostgreSQL Total Rows: 1739
MariaDB Total Rows:    1739
Difference:            0

Status: ✓ SUCCESS - All rows transferred!



  IMPORTANT NOTES:


1. Script DESTROYS MariaDB data
   └─ Do NOT run on production without backup
   └─ Make backup first: mysqldump ...

2. PostgreSQL "user" table is renamed to "users_extension"
   └─ Some columns are filtered (only necessary ones kept)

3. Data stored temporarily in migration_tmp/
   └─ Clean up afterwards with: rm -rf migration_tmp/

4. Row counts match if:
   └─ PostgreSQL 1,739 rows = MariaDB 1,739 rows

5. Passwords in plain text during execution
   └─ Use on secure network or locally





Problem: "Command not found: psql"
Solution: sudo apt-get install postgresql-client

Problem: "Command not found: mysql"
Solution: sudo apt-get install mariadb-client

Problem: "Connection refused" (PostgreSQL)
Solution: Verify host, port, user, password

Problem: "Connection refused" (MariaDB)
Solution: Verify host, port, user, password

Problem: "Script python not found"
Solution: Verify convert_pg_copy_to_mariadb.py is in migrations/

Problem: "Row count mismatch"
Solution: Review results.txt to see differences per table





PostgreSQL (BEFORE):                MariaDB (AFTER):

Tables: 28                          Tables: 28
Special table: "user"               Special table: "users_extension"
Total rows: 1,739                   Total rows: 1,739

Data included:
   • audit_logs: 232 rows
   • balance_events: 1 row
   • countries: 55 rows
   • factions: 8 rows
   • faction_map_statistics: 123 rows
   • faction_map_statistics_history: 486 rows
   • tournaments: 16 rows
   • users: 19 rows (→ users_extension)
   • ... and more





See file: MIGRATION_README_EN.md
   Contains:
   • Detailed instructions
   • Report formats
   • Use cases
   • Security
   • File cleanup


