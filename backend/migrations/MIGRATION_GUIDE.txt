
           MIGRACIÓN POSTGRESQL → MARIADB - GUÍA RÁPIDA                    ║



1. migration_complete.sh
   └─ Script principal que automatiza toda la migración
   └─ Incluye: exportación, conversión, importación, reportes
   └─ Ejecución: ./migration_complete.sh

2. convert_pg_copy_to_mariadb.py
   └─ Script Python para conversión de datos
   └─ Transforma formato COPY (PostgreSQL) a INSERT (MariaDB)
   └─ Agrupa filas por tabla para eficiencia
   └─ Escapa palabras reservadas (ej: `order`)

3. mariadb_database_migration_structure.sql
   └─ Define estructura de 28 tablas con DROP y CREATE
   └─ Se ejecuta automáticamente por migration_complete.sh
   └─ Incluye todas las columnas y tipos de datos correctos

4. MIGRATION_README.md
   └─ Documentación detallada del proceso
   └─ Requisitos, instalación, troubleshooting





OPCIÓN 1 - Ejecución interactiva (RECOMENDADO):


   cd backend/migrations/
   ./migration_complete.sh

   El script pedirá:
   • PostgreSQL: host, port, database, user, password
   • MariaDB:    host, port, database, user, password

   ⏱️  Tiempo estimado: 2-5 minutos


OPCIÓN 2 - Con variables de entorno:


   export PG_HOST="localhost"
   export PG_PORT="5432"
   export PG_DB="tournament_dbdatabase"
   export PG_USER="postgres"
   export PG_PASS="your_pass"
   
   export MB_HOST="host"
   export MB_PORT="3306"
   export MB_DB="database"
   export MB_USER="user"
   export MB_PASS="your_pass"
   
   ./migration_complete.sh





PASO 1: Exporta datos de PostgreSQL
   └─ Archivo: pg_data_export_[TIMESTAMP].sql
   └─ Formato: COPY (tab-separated values)

PASO 2: Obtiene conteos ANTES
   └─ Archivo: before.txt
   └─ Contiene: Todas las tablas y rowcounts de PostgreSQL

PASO 3: Convierte formato de datos
   └─ Archivo: mariadb_converted_[TIMESTAMP].sql
   └─ Convierte COPY → INSERT agrupados
   └─ Escapa palabras reservadas
   └─ Limpia timestamps (remove +00 timezone)

PASO 4: Conecta a MariaDB
   └─ Ejecuta: mariadb_database_migration_structure.sql
   └─ Resultado: DROP + CREATE de 28 tablas

PASO 5: Importa datos a MariaDB
   └─ Ejecuta el archivo SQL convertido
   └─ Total: 1,739 filas en 27 tablas

PASO 6: Obtiene conteos DESPUÉS
   └─ Archivo: after.txt
   └─ Contiene: Todas las tablas y rowcounts de MariaDB

PASO 7: Genera reporte de comparación
   └─ Archivo: results.txt
   └─ Compara PostgreSQL vs MariaDB
   └─ Muestra: ✓ SUCCESS o ✗ MISMATCH





En directorio migrations/:
   • before.txt       - Rowcounts PostgreSQL
   • after.txt        - Rowcounts MariaDB
   • results.txt      - Reporte de comparación

En directorio migration_tmp/:
   • pg_data_export_[timestamp].sql     - Datos raw PostgreSQL
   • mariadb_converted_[timestamp].sql  - Datos convertidos



 VERIFICACIÓN DE ÉXITO:


La migración fue exitosa si:

   ✓ El script termina SIN ERRORES
   ✓ results.txt muestra: Status: ✓ SUCCESS
   ✓ Difference = 0 en el resumen
   ✓ Todas las tablas tienen ✓ en comparación detallada
   ✓ Total: PostgreSQL = MariaDB

Ejemplo de results.txt correcto:

PostgreSQL Total Rows: 1739
MariaDB Total Rows:    1739
Difference:            0

Status: ✓ SUCCESS - All rows transferred!



  NOTAS IMPORTANTES:


1. El script DESTRUYE datos de MariaDB
   └─ No ejecutar en producción sin backup
   └─ Hacer backup primero: mysqldump ...

2. La tabla "user" de PostgreSQL se renombra a "users_extension"
   └─ Algunas columnas se filtran (solo se mantienen las necesarias)

3. Los datos se almacenan temporalmente en migration_tmp/
   └─ Puedes limpiar después con: rm -rf migration_tmp/

4. Los conteos coinciden si:
   └─ PostgreSQL 1,739 filas = MariaDB 1,739 filas

5. Contraseñas en texto plano durante ejecución
   └─ Usar en red segura o localización local





Problema: "Command not found: psql"
Solución: sudo apt-get install postgresql-client

Problema: "Command not found: mysql"
Solución: sudo apt-get install mariadb-client

Problema: "Connection refused" (PostgreSQL)
Solución: Verificar host, puerto, usuario, password

Problema: "Connection refused" (MariaDB)
Solución: Verificar host, puerto, usuario, password

Problema: "Script python not found"
Solución: Verificar convert_pg_copy_to_mariadb.py está en migrations/

Problema: "Row count mismatch"
Solución: Revisar results.txt para ver diferencias por tabla





PostgreSQL (ANTES):                 MariaDB (DESPUÉS):

Tablas: 28                          Tablas: 28
Tabla especial: "user"              Tabla especial: "users_extension"
Total filas: 1,739                  Total filas: 1,739

Datos incluidos:
   • audit_logs: 232 filas
   • balance_events: 1 fila
   • countries: 55 filas
   • factions: 8 filas
   • faction_map_statistics: 123 filas
   • faction_map_statistics_history: 486 filas
   • tournaments: 16 filas
   • users: 19 filas (→ users_extension)
   • ... y más





Ver archivo: MIGRATION_README.md
   Contiene:
   • Instrucciones detalladas
   • Formatos de reportes
   • Casos de uso
   • Seguridad
   • Limpieza de archivos


