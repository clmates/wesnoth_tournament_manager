# Phase 7: Automated Replay Detection and Processing
# Configuration Example
# 
# Copy this to .env and configure with your Debian server settings
# Date: February 17, 2026

# ============================================================================
# Replay Directory Configuration
# ============================================================================

# Full path to Wesnoth replays directory on Debian server
# This is where Wesnoth multiplayer server writes replay files
# Example: /var/games/wesnoth/replays (typical Debian location)
WESNOTH_REPLAY_DIR=/var/games/wesnoth/replays

# File extension to monitor
# Standard Wesnoth replay format is .rpy.gz (gzip-compressed WML)
WESNOTH_REPLAY_EXTENSION=.rpy.gz

# ============================================================================
# Replay Processing Configuration
# ============================================================================

# Enable/disable automatic replay parsing
# Set to true to start the service on application startup
REPLAY_AUTO_PARSE=true

# Background job execution interval (seconds)
# How often to check for new unparsed replays
# Recommended: 30 seconds (balance between timely parsing and low CPU)
REPLAY_PARSER_INTERVAL_SECONDS=30

# Maximum concurrent replay parses
# How many replays to parse at the same time
# Recommended: 3-5 (depends on CPU and available memory)
REPLAY_MAX_CONCURRENT_PARSES=3

# Maximum time to wait for replay file to finish writing (seconds)
# Before parsing, we wait at least this long after CLOSE_WRITE event
# Recommended: 5 seconds (allow file system to flush)
REPLAY_WRITE_COMPLETION_WAIT_SECONDS=5

# ============================================================================
# Tournament Addon Configuration
# ============================================================================

# UUID or ID of the tournament addon
# This addon must be present in the replay to qualify as a tournament match
# The quick addon check (Stage 1) searches for this specific addon
# If not found, the replay is skipped (not tournament)
# 
# Examples:
#   tournament-addon
#   wesnoth-tournament-v1.18
#   Your-org-tournament-addon-uuid
REPLAY_ADDON_FILTER=tournament-addon

# ============================================================================
# Validation & Security
# ============================================================================

# Strict validation of replay files
# If true, replays must pass additional integrity checks
# Recommended: true (for production)
REPLAY_VALIDATION_STRICT=true

# Verify replay hasn't been tampered (checksum validation)
# Requires storing checksums in database
REPLAY_VERIFY_CHECKSUMS=true

# ============================================================================
# Logging & Monitoring
# ============================================================================

# Log level for replay processing
# Options: debug, info, warn, error
REPLAY_LOG_LEVEL=info

# Enable detailed parsing logs?
# Creates replay_parsing_logs table entries for debugging
REPLAY_DEBUG_PARSING=false

# ============================================================================
# Performance Tuning
# ============================================================================

# Maximum replay file size to process (bytes)
# Reject replays larger than this
# Recommended: 50MB (50000000 bytes)
REPLAY_MAX_FILE_SIZE=50000000

# Parse timeout per replay (milliseconds)
# If parsing takes longer, abort and mark as error
REPLAY_PARSE_TIMEOUT_MS=60000

# ============================================================================
# Database Configuration (usually in main .env)
# ============================================================================

# Ensure these are configured in your main .env:
# DB_HOST=localhost
# DB_USER=tournament_user
# DB_PASSWORD=***
# DB_NAME=wesnoth_tournament

# ============================================================================
# Notification Configuration (optional)
# ============================================================================

# Notify winner when auto-reported match is created?
REPLAY_NOTIFY_WINNER=true

# Notify loser when auto-reported match is created?
REPLAY_NOTIFY_LOSER=true

# Email template for notifications (if email enabled)
REPLAY_WINNER_EMAIL_TEMPLATE=match_confirmed

# ============================================================================
# Integration Testing (for development only)
# ============================================================================

# Enable test mode?
# If true, creates dummy replays for testing
TEST_MODE=false

# Send events to test event emitter
TEST_EVENT_EMITTER=false
